{% extends "base.html" %}

{% block content %}
<h1>Pendência de validação de documento</h1>
<div class="row-fluid">
    <div class="box span12">
        <div class="box-header">
            <h2>Dados do documento</h2>
        </div>
        <div class="box-content">
            <div class="row-fluid">
                <div class="span2"><strong>Empresa:</strong></div>
                <div class="span2">{{pendencia.documento.empresa}}</div>
                <div class="span2"><strong>Protocolo:</strong></div>
                <div class="span2">{{pendencia.documento.protocolo}}</div>
                <div class="span2"><strong>Data Referência:</strong></div>
                <div class="span2">{{pendencia.documento.data_referencia}}</div>
            </div>
            <div class="row-fluid">
                <div class="span2"><strong>Responsável:</strong></div>
                <div class="span2">{{pendencia.responsavel}}</div>
                <div class="span2"><strong>Responsável pela leitura:</strong></div>
                <div class="span2">{{pendencia.documento.investidorleituradocumento}}</div>
                <div class="span2"><strong>Decisão:</strong></div>
                <div class="span2">{{pendencia.decisao}}</div>
            </div>
            <div class="row-fluid">
                <div class="span4"><a href="{% url 'baixar_documento_provento' pendencia.documento.id %}" class="btn btn-warning">Download</a></div>
            </div>
        </div>
    </div>
</div>
{% if pendencia.responsavel.id == request.user.investidor.id %}
<div class="row-fluid">
    <div class="box span12">
        <form method="POST" class="post-form form-horizontal">{% csrf_token %}
            <div id="forms">
                <div class="row-fluid">
                {% for descricao_provento in descricoes_proventos %}
                    <div class="box span6">
                        <div class="box-header">
                            <h2>Provento {{forloop.counter}} (Identificador: {{descricao_provento.id}})</h2>
                        </div>
                        <div class="box-content">
                            <div class="row-fluid">
                                <div class="span1"><strong>Ação:</strong></div>
                                <div class="span2">{{descricao_provento.acao}}</div>
                                <div class="span1"><strong>Tipo:</strong></div>
                                <div class="span2">{{descricao_provento.descricao_tipo_provento}}</div>
                                <div class="span2"><strong>Valor unit.:</strong></div>
                                {% if descricao_provento.tipo_provento != 'A' %}
                                    <div class="span4">R$ {{descricao_provento.valor_unitario}}</div>
                                {% else %}
                                    <div class="span4">{{descricao_provento.valor_unitario}}%</div>
                                {% endif %}
                            </div>
                            <div class="row-fluid">
                                <div class="span2"><strong>Data EX:</strong></div>
                                <div class="span4">{{descricao_provento.data_ex}}</div>
                                <div class="span2"><strong>Pagamento:</strong></div>
                                <div class="span4">{{descricao_provento.data_pagamento}}</div>
                            </div>
                            {% if descricao_provento.tipo_provento == 'A' %}
                                {% for acao_descricao_provento in descricao_provento.acoes_recebidas %}
                                <div class="row-fluid">
                                    <div class="span3"><strong>Ação recebida:</strong></div>
                                    <div class="span3">{{acao_descricao_provento.acao_recebida}}</div>
                                    <div class="span2"><strong>Valor de frações:</strong></div>
                                    <div class="span4">R$ {{acao_descricao_provento.valor_calculo_frac}}</div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span4"><strong>Pagamento de frações:</strong></div>
                                    <div class="span4">{{acao_descricao_provento.data_pagamento_frac}}</div>
                                </div>
                                {% endfor%}
                            {% endif %}
                            <label class="checkbox inline">
                                <div class="checker"><span><input type="checkbox" id="checkbox_alteracao_{{descricao_provento.id}}" name="{{descricao_provento.id}}" 
                                    value="{{descricao_provento.id}}"></span></div> Relacionado a:
                            </label>
                        </div>
                        <div class="box-header">
                            Proventos próximos
                        </div>
                        <div class="box-content">
                            {% for provento_proximo in descricao_provento.proventos_proximos %}
                            <div class="row-fluid">
                                <div class="span1"><strong>Ação:</strong></div>
                                <div class="span2">{{provento_proximo.acao}}</div>
                                <div class="span1"><strong>Tipo:</strong></div>
                                <div class="span2">{{provento_proximo.descricao_tipo_provento}}</div>
                                <div class="span2"><strong>Valor unit.:</strong></div>
                                {% if provento_proximo.tipo_provento != 'A' %}
                                    <div class="span4">R$ {{provento_proximo.valor_unitario}}</div>
                                {% else %}
                                    <div class="span4">{{provento_proximo.valor_unitario}}%</div>
                                {% endif %}
                            </div>
                            <div class="row-fluid">
                                <div class="span2"><strong>Data EX:</strong></div>
                                <div class="span4">{{provento_proximo.data_ex}}</div>
                                <div class="span2"><strong>Pagamento:</strong></div>
                                <div class="span4">{{provento_proximo.data_pagamento}}</div>
                            </div>
                            {% if provento_proximo.tipo_provento == 'A' %}
                                {% for acao_descricao_provento in provento_proximo.acoes_recebidas %}
                                <div class="row-fluid">
                                    <div class="span3"><strong>Ação recebida:</strong></div>
                                    <div class="span3">{{acao_descricao_provento.acao_recebida}}</div>
                                    <div class="span2"><strong>Valor de frações:</strong></div>
                                    <div class="span4">R$ {{acao_descricao_provento.valor_calculo_frac}}</div>
                                </div>
                                <div class="row-fluid">
                                    <div class="span4"><strong>Pagamento de frações:</strong></div>
                                    <div class="span4">{{acao_descricao_provento.data_pagamento_frac}}</div>
                                </div>
                                {% endfor %}
                            {% endif %}
                            <label class="radio">
                                <input name="descricao_{{descricao_provento.id}}" value="{{provento_proximo.id}}" disabled="disabled" type="radio">
                            Este provento
                            </label>
                            {% if forloop.counter < descricao_provento.proventos_proximos|length %}
                            <hr>
                            {% endif %}
                            {% empty %}
                            <div class="row-fluid">
                                <div class="span12"><strong>Não há proventos próximos</strong></div>    
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
                </div>
                <div class="row-fluid" id="motivo_recusa">
                    <h4>Motivo da recusa:</h4>
                    <textarea name="motivo_recusa" class="span12"></textarea>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" name="validar" value="1" class="btn" id="btn_confirma_validar">Confirma validação</button>
                <button type="submit" name="recusar" value="0" class="btn btn-danger" id="btn_confirma_recusar">Confirma recusa</button>
                <a class="btn btn-warning" id="btn_cancelar">Cancelar</a>
                <a class="btn" id="btn_validar">Validar</a>
                <a class="btn btn-danger" id="btn_recusar">Recusar</a>
            </div>
        </form>
    </div>
</div>
{% endif %}

<script>
$( document ).ready(function() {
	$('input[id*=checkbox_alteracao]').click(function() {
		if ($(this).attr('checked')) {
    		$('input[name*=descricao_' + $(this).val() + ']').each(function() {
                $(this).removeAttr("disabled");
    		});
		} else {
			$('input[name*=descricao_' + $(this).val() + ']').each(function() {
                $(this).attr('disabled', 'disabled');
                $(this).parent().removeClass('checked')
            });
		}
	});
	
	// Iniciar botões
    $('#btn_confirma_validar').hide();
    $('#btn_confirma_recusar').hide();
    $('#btn_cancelar').hide();
    $('#motivo_recusa').hide();
	
	
	$('#btn_validar').click(function() {
		$('#btn_confirma_validar').show();
        $('#btn_cancelar').show();
        $('#btn_recusar').hide();
        $(this).hide();
	});
	$('#btn_recusar').click(function() {
        $('#btn_confirma_recusar').show();
        $('#btn_cancelar').show();
        $('#btn_validar').hide();
        $(this).hide();
        
        $('#motivo_recusa').show();
    });
	$('#btn_cancelar').click(function() {
        $('#btn_confirma_validar').hide();
        $('#btn_confirma_recusar').hide();
        $('#btn_validar').show();
        $('#btn_recusar').show();
        $(this).hide();
        
        $('#motivo_recusa').hide();
    });
});
</script>
    
{% endblock %}

{% extends "teste/base.html" %}
{% load staticfiles %}

{% block extra_head %}
<link href={% static "assets/global/plugins/bootstrap-select/css/bootstrap-select.min.css" %} rel="stylesheet" type="text/css" />
<link href={% static "assets/global/plugins/bootstrap-datepicker/css/bootstrap-datepicker3.min.css" %} rel="stylesheet" type="text/css" />
<link href={% static "assets/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" %} rel="stylesheet" type="text/css" />
{% endblock %}

{% block content %}
<div class="portlet light">
    <div class="portlet-title">
        <div class="caption font-yellow-crusta">
            <i class="icon-list font-yellow-crusta"></i>
            <span class="caption-subject bold uppercase">Pendência de leitura de documento</span>
        </div>
    </div>
    <div class="portlet-body">
        <div class="row">
            <div class="col-md-12">
                <div class="portlet box yellow-crusta">
                    <div class="portlet-title">
                        <div class="caption">
                        {% comment %}
                        Buscar um ícone melhor para esse portlet header
                        {% endcomment %}
                            <i class="fa fa-line-chart"></i>Dados do documento
                        </div>
                        <div class="tools">
                            <a href="javascript:;" class="collapse"></a>
                        </div>
                    </div>
                    <div class="portlet-body">
                        <div class="m-grid m-grid-responsive-xs">
                            <div class="m-grid-row">
                                <div class="m-grid-col m-grid-col-left"><strong>Empresa:</strong></div>
                                <div class="m-grid-col m-grid-col-left">{{pendencia.documento.empresa}}</div>
                                <div class="m-grid-col m-grid-col-left"><strong>Protocolo:</strong></div>
                                <div class="m-grid-col m-grid-col-left">{{pendencia.documento.protocolo}}</div>
                                <div class="m-grid-col m-grid-col-left"><strong>Data Referência:</strong></div>
                                <div class="m-grid-col m-grid-col-left">{{pendencia.documento.data_referencia}}</div>
                                <div class="m-grid-col m-grid-col-left"><strong>Responsável:</strong></div>
                                <div class="m-grid-col m-grid-col-left">{{pendencia.responsavel}}</div>
                            </div>
                            <div class="m-grid-row">
                                <a href="{% url 'baixar_documento_provento' pendencia.documento.id %}" class="btn btn-warning">Download</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% if pendencia.responsavel.id == request.user.investidor.id %}
        <div class="row">
            <div class="col-md-12">
                <div class="portlet box yellow-crusta">
                    <div class="portlet-title">
                        <div class="caption">
                        {% comment %}
                        Buscar um ícone melhor para esse portlet header
                        {% endcomment %}
                            <i class="fa fa-line-chart"></i>Formulário do documento
                        </div>
                    </div>
                    <div class="portlet-body form">
                        <div class="row">
                            <form method="POST" class="col-md-12 horizontal-form">{% csrf_token %}
                                <div class="form-body" style="margin: 0px 20px;">
                                    <div class="row">
                                        <div class="form-group col-md-6">
                                            <label class="col-md-5 control-label"> Documento descreve proventos? </label>
                                            <div class="col-md-7">
                                                <div class="md-radio-inline">
                                                    <div class="md-radio">
                                                        <input type="radio" class="md-radiobtn" name="radioDocumento" id="radioDocumento1" value="1" checked>
                                                        <label for="radioDocumento1">
                                                            <span></span>
                                                            <span class="check"></span>
                                                            <span class="box"></span> Sim 
                                                        </label>
                                                    </div>
                                                    <div class="md-radio">
                                                        <input type="radio" class="md-radiobtn" name="radioDocumento" id="radioDocumento2" value="0">
                                                        <label for="radioDocumento2">
                                                            <span></span>
                                                            <span class="check"></span>
                                                            <span class="box"></span> Não 
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="form-group col-md-6" id="qtd_proventos">
                                            <label class="control-label col-md-4" style="text-align: left;"> Número de proventos: </label>
                                            <div class="col-md-2">
                                                <select class="selectpicker form-control" id="num_proventos" name="num_proventos">
                                                    <option>1</option>
                                                    <option>2</option>
                                                    <option>3</option>
                                                    <option>4</option>
                                                    <option>5</option>
                                                    <option>6</option>
                                                    <option>7</option>
                                                    <option>8</option>
                                                    <option>9</option>
                                                    <option>10</option>
                                                </select>
                                            </div>
                                            <input type="submit" class="btn btn-warning" value="Preparar proventos" name="preparar_proventos" id="preparar_proventos">
                                        </div>
                                    </div>
                                    <div class="row" id="form_criar_proventos">
                                        <div class="col-md-12">
                                            {{ formset_provento.management_form }}
                                            {{ formset_acao_provento.management_form }}
                                            {% for form_provento in formset_provento.forms %}
                                            <div class="col-md-12">
                                                <h2 class="font-yellow-crusta" align="center">
                                                    <strong>Provento {{ forloop.counter }}</strong>
                                                </h2>
                                            </div>
                                            <div class="row">
                                                <div class="form-group col-md-4 {% if form_provento.valor_unitario.errors %} has-error {% endif %}">
                                                    <label class="control-label col-md-4"> Valor unitário: </label>
                                                    <div class="col-md-8">
                                                        <input id="id_provento-{{forloop.counter0}}-valor_unitario" type="text" value="0" name="provento-{{forloop.counter0}}-valor_unitario" class="form-control">
                                                        {% if form_provento.valor_unitario.errors %} <span class="help-block"> {{ form_provento.valor_unitario.errors.as_text }} </span> {% endif %}
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4 {% if form_provento.data_ex.errors %} has-error {% endif %}">
                                                    <label class="control-label col-md-4" style="text-align: left;"> Data EX: </label>
                                                    <div class="col-md-8">
                                                        <div class="input-group input-medium date date-picker" data-date-format="dd/mm/yyyy" id="id_provento-{{forloop.counter0}}-data_ex" name="provento-{{forloop.counter0}}-data_ex" data-date="{{form_provento.data_ex.value|default:''}}" data-date-viewmode="years">
                                                            <input type="text" class="form-control">
                                                            <span class="input-group-btn">
                                                                <button class="btn default" type="button">
                                                                    <i class="fa fa-calendar"></i>
                                                                </button>
                                                            </span>
                                                        </div>
                                                        <span class="help-block"> Selecione uma data </span>
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4 {% if form.data_pagamento.errors %} has-error {% endif %}">
                                                    <label class="control-label col-md-4" style="text-align: left;"> Data de pagamento: </label>
                                                    <div class="col-md-8">
                                                        <div class="input-group input-medium date date-picker" data-date-format="dd/mm/yyyy" id="id_provento-{{forloop.counter0}}-data_pagamento" name="provento-{{forloop.counter0}}-data_pagamento" data-date="{{form.data_pagamento.value|default:''}}" data-date-viewmode="years">
                                                            <input type="text" class="form-control">
                                                            <span class="input-group-btn">
                                                                <button class="btn default" type="button">
                                                                    <i class="fa fa-calendar"></i>
                                                                </button>
                                                            </span>
                                                        </div>
                                                        <span class="help-block"> Selecione uma data </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="form-group col-md-4 {% if form_provento.tipo_provento.errors %} has-error {% endif %}">
                                                    <label class="control-label col-md-4" style="text-align: left;"> Tipo de provento: </label>
                                                    <div class="col-md-8">
                                                        <select class="selectpicker form-control" id="id_provento-{{forloop.counter0}}-tipo_provento" name="provento-{{forloop.counter0}}-tipo_provento">
                                                            {% for key, value in form_provento.fields.tipo_provento.widget.choices %}<option value="{{ key }}">{{ value }}</option>{% endfor %}
                                                        </select>
                                                        {% if form_provento.tipo_provento.errors %} <span class="help-block"> {{ form_provento.tipo_provento.errors.as_text }} </span> {% endif %}
                                                    </div>
                                                </div>
                                                <div class="form-group col-md-4 {% if form_provento.acao.errors %} has-error {% endif %}">
                                                    <label class="control-label col-md-4" style="text-align: left;"> Ação: </label>
                                                    <div class="col-md-8">
                                                        <select class="selectpicker form-control" id="id_provento-{{forloop.counter0}}-acao" name="provento-{{forloop.counter0}}-acao">
                                                            {% for key, value in form_provento.fields.acao.choices %}<option value="{{ key }}">{{ value }}</option>{% endfor %}
                                                        </select>
                                                        {% if form_provento.acao.errors %} <span class="help-block"> {{ form_provento.acao.errors.as_text }} </span> {% endif %}
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="provento_em_acao-{{forloop.counter0}}" class="row">
                                            {% for form_acao_provento in formset_acao_provento.forms %}
                                                {% if forloop.counter == forloop.parentloop.counter %}
                                                    <div class="form-group col-md-4 {% if form_acao_provento.acao_recebida.errors %} has-error {% endif %}">
                                                        <label class="control-label col-md-4" style="text-align: left;"> Ação recebida: </label>
                                                        <div class="col-md-8">
                                                            <select class="selectpicker form-control" id="id_acao_provento-{{forloop.counter0}}-acao_recebida" name="acao_provento-{{forloop.counter0}}-acao_recebida">
                                                                {% for key, value in form_acao_provento.fields.acao_recebida.choices %}<option value="{{ key }}">{{ value }}</option>{% endfor %}
                                                            </select>
                                                            {% if form_acao_provento.acao_recebida.errors %} <span class="help-block"> {{ form_acao_provento.acao_recebida.errors.as_text }} </span> {% endif %}
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-4 {% if form.data_pagamento_frac.errors %} has-error {% endif %}">
                                                        <label class="control-label col-md-4" style="text-align: left;"> Data de pagamento de frações: </label>
                                                        <div class="col-md-8">
                                                            <div class="input-group input-medium date date-picker" data-date-format="dd/mm/yyyy" id="id_acao_provento-{{forloop.counter0}}-data_pagamento_frac" name="acao_provento-{{forloop.counter0}}-data_pagamento_frac" data-date="{{form.data_pagamento_frac.value|default:''}}" data-date-viewmode="years">
                                                                <input type="text" class="form-control">
                                                                <span class="input-group-btn">
                                                                    <button class="btn default" type="button">
                                                                        <i class="fa fa-calendar"></i>
                                                                    </button>
                                                                </span>
                                                            </div>
                                                            <span class="help-block"> Selecione uma data </span>
                                                        </div>
                                                    </div>
                                                    <div class="form-group col-md-4 {% if form_acao_provento.valor_calculo_frac.errors %} has-error {% endif %}">
                                                        <label class="control-label col-md-4"> Valor das frações: </label>
                                                        <div class="col-md-8">
                                                            <input id="id_acao_provento-{{forloop.counter0}}-valor_calculo_frac" type="text" value="0" name="acao_provento-{{forloop.counter0}}-valor_calculo_frac" class="form-control">
                                                            {% if form_acao_provento.valor_calculo_frac.errors %} <span class="help-block"> {{ form_acao_provento.valor_calculo_frac.errors.as_text }} </span> {% endif %}
                                                        </div>
                                                    </div>
                                                {% endif %}
                                            {% endfor %}
                                            </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                    <div class="form-actions">
                                        <div class="row">
                                            <div class="col-md-2">
                                                <button type="submit" class="btn green-steel" name="save" value="1">Salvar</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
            
            
{% comment %}
{% if pendencia.responsavel.id == request.user.investidor.id %}
<div class="row-fluid">
    <div class="box span12">
        <form method="POST" class="post-form form-horizontal">{% csrf_token %}
            <div id="forms">
                <div id="form_criar_proventos">
                    {{ formset_provento.management_form }}
                    {{ formset_acao_provento.management_form }}
                    {% for form_provento in formset_provento.forms %}
                        <div class="row-fluid">
                            <div class="span6">
                                <h3>Provento {{ forloop.counter }}</h3>
                                {{ form_provento.as_p }}
                                <div id="provento_em_acao-{{forloop.counter0}}">
                                {% for form_acao_provento in formset_acao_provento.forms %}
                                    {% if forloop.counter == forloop.parentloop.counter %}
                                        {{form_acao_provento.as_p}}
                                    {% endif %}
                                {% endfor %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </form>
    </div>
</div>
{% endif %}
{% endcomment %}

{% endblock %}

{% block extra_footer %}
<script src={% static "assets/global/plugins/fuelux/js/spinner.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/bootstrap-touchspin/bootstrap.touchspin.js" %} type="text/javascript"></script>
<script src={% static "assets/pages/scripts/components-bootstrap-touchspin.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/jquery-validation/js/jquery.validate.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/jquery-validation/js/additional-methods.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/bootstrap-select/js/bootstrap-select.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/moment.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/bootstrap-daterangepicker/daterangepicker.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/bootstrap-datepicker/js/bootstrap-datepicker.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js" %} type="text/javascript"></script>
<script src={% static "assets/global/plugins/bootstrap-datepicker/locales/bootstrap-datepicker.pt-BR.min.js" %} type="text/javascript"></script>

<script>
$( document ).ready(function() {
	$('#num_proventos').selectpicker();
	
	$("input[name*='valor_unitario']").TouchSpin({
        min: 0,
        max: 1000000000,
        step: 0.01,
        decimals: 2,
        maxboostedstep: 100,
        prefix: 'R$'
    });
	$("input[name*='valor_calculo_frac']").TouchSpin({
        min: 0,
        max: 1000000000,
        step: 0.01,
        decimals: 2,
        maxboostedstep: 100,
        prefix: 'R$'
    });
	
    $('.date-picker').datepicker({
        language: 'pt-BR'
    });
	
	$("input[name='radioDocumento']").click(function () {
		if ($(this).val() == '1') {
			$('#form_criar_proventos').show();
			$('#qtd_proventos').show();
		} else {
            $('#form_criar_proventos').hide();
            $('#qtd_proventos').hide();
		}
	});
	
	// Inicializar proventos em ações
	$("select[name*=tipo_provento]").each( function() {
        var id_provento = $(this).attr('id').match(/\d+/)[0];
        if ($(this).val() == 'A') {
            $('#provento_em_acao-' + id_provento).show();
        } else {
            $('#provento_em_acao-' + id_provento).hide();
        }
    });
	
	$("select[name*=tipo_provento]").change( function() {
        var id_provento = $(this).attr('id').match(/\d+/)[0];
		if ($(this).val() == 'A') {
			$('#provento_em_acao-' + id_provento).show();
		} else {
            $('#provento_em_acao-' + id_provento).hide();
		}
	});
});
</script>
    
{% endblock %}
